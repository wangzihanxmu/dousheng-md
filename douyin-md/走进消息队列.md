# 第十六节：走进消息队列

## 概述

本节课程主要分为五个方面：

1. 消息队列的前世今生
2. 消息队列-Kafka
3. 消息队列-BMQ
4. 消息队列-RocketMQ
5. 最佳实践

课前部分主要罗列课程中涉及到的概念。对于不熟悉的概念，同学们可以提前查询预习；课中部分主要罗列每一部分的关键思路，帮助同学们跟上课程的进度；课后部分是一些问题，帮助同学们在课后梳理本课程的重点。

## 课前

### 消息队列的前世

- 消息队列应用场景

- 消息队列的发展历史

### 常见消息队列

- Kafka使用场景、架构、高级特性

- Pulsar使用场景、架构、高级特性

- Rocket使用场景、架构、高级特性

## 课中

### 消息队列是什么

- 解耦

- 削峰

- 异步

- 日志处理

### 消息队列的前世今生

#### 消息队列-Kafka

kafka使用场景，业务日志、用户行为数据、Metrics数据

基本概念，Producer、Cluster、Consumer、Topic、Partition

数据迁移、Offset、Partition选主

一条消息从生产到消费是如何处理的，Producer端逻辑、Broker端逻辑、Consumer端逻辑

#### 消息队列-BMQ

Kafka在使用中遇到问题

BMQ架构

BMQ各模块是如何工作的，Broker、Proxy、HDFS、MetaStorage

BMQ多机房容灾

#### 消息队列-RocketMQ

RocketMQ使用场景

RocketMQ和Kafka对比

RocketMQ架构介绍，Producer、Broker、Nameserver、Consumer

一条消息从生产到消费是如何处理的，Producer端逻辑、Broker端逻辑、Consumer端逻辑

#### 消息队列在字节

一些最佳实践的场景，包括数据展示

### 课后作业：

1. 消息队列的应用场景有哪些？
2. Kafka 的哪些 Feature 让其可以支撑大吞吐写入的场景？
3. Kafka Consumer Rebalance 的流程简述？
4. BMQ 相比较 Kafka 有哪些优势？
5. RocketMQ 有哪些特有的 Feature？
6. RocketMQ 事务消息处理流程简述？
7. 你认为 MQ 后面应该如何发展？（开放题）

作者：社区助手
链接：https://juejin.cn/post/7100199258900398093/
来源：稀土掘金
著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。

![image-20220531122133318](走进消息队列.assets/image-20220531122133318.png)

![image-20220531122147940](走进消息队列.assets/image-20220531122147940.png)

![image-20220531122314097](走进消息队列.assets/image-20220531122314097.png)

![image-20220531122445055](走进消息队列.assets/image-20220531122445055.png)

![image-20220531122526694](走进消息队列.assets/image-20220531122526694.png)

![image-20220531122540972](走进消息队列.assets/image-20220531122540972.png)

![image-20220531122607245](走进消息队列.assets/image-20220531122607245.png)

![image-20220531122659726](走进消息队列.assets/image-20220531122659726.png)

![image-20220531122716614](走进消息队列.assets/image-20220531122716614.png)

![image-20220531122814183](走进消息队列.assets/image-20220531122814183.png)

![image-20220531122850495](走进消息队列.assets/image-20220531122850495.png)

![image-20220531122933445](走进消息队列.assets/image-20220531122933445.png)

![image-20220531123007993](走进消息队列.assets/image-20220531123007993.png)

![image-20220531123811873](走进消息队列.assets/image-20220531123811873.png)

![image-20220531123909686](走进消息队列.assets/image-20220531123909686.png)

![image-20220531124108516](走进消息队列.assets/image-20220531124108516.png)

![image-20220531124320347](走进消息队列.assets/image-20220531124320347.png)

![image-20220531124437333](走进消息队列.assets/image-20220531124437333.png)

![image-20220531124626666](走进消息队列.assets/image-20220531124626666.png)

![image-20220531125325245](走进消息队列.assets/image-20220531125325245.png)

![image-20220531131849523](走进消息队列.assets/image-20220531131849523.png)

![image-20220531131915024](走进消息队列.assets/image-20220531131915024.png)

![image-20220531131930297](走进消息队列.assets/image-20220531131930297.png)

![image-20220531132011275](走进消息队列.assets/image-20220531132011275.png)

![image-20220531132102580](走进消息队列.assets/image-20220531132102580.png)

推荐使用ZSTD

![image-20220531132155712](走进消息队列.assets/image-20220531132155712.png)

![image-20220531132218455](走进消息队列.assets/image-20220531132218455.png)

![image-20220531132455671](走进消息队列.assets/image-20220531132455671.png)

![image-20220531132615028](走进消息队列.assets/image-20220531132615028.png)

![image-20220531132749730](走进消息队列.assets/image-20220531132749730.png)

![image-20220531132907909](走进消息队列.assets/image-20220531132907909.png)

![image-20220531133051423](走进消息队列.assets/image-20220531133051423.png)

![image-20220531133127015](走进消息队列.assets/image-20220531133127015.png)

![image-20220531133204826](走进消息队列.assets/image-20220531133204826.png)

![image-20220531133340983](走进消息队列.assets/image-20220531133340983.png)

![image-20220531133508689](走进消息队列.assets/image-20220531133508689.png)

![image-20220531133627853](走进消息队列.assets/image-20220531133627853.png)

![image-20220531133820458](走进消息队列.assets/image-20220531133820458.png)

自动分配

![image-20220531134032661](走进消息队列.assets/image-20220531134032661.png)

![image-20220531134424682](走进消息队列.assets/image-20220531134424682.png)

![image-20220531134605872](走进消息队列.assets/image-20220531134605872.png)

![image-20220531134749768](走进消息队列.assets/image-20220531134749768.png)

![image-20220531135115778](走进消息队列.assets/image-20220531135115778.png)

![image-20220531135510998](走进消息队列.assets/image-20220531135510998.png)

![image-20220531135708075](走进消息队列.assets/image-20220531135708075.png)

![image-20220531140009620](走进消息队列.assets/image-20220531140009620.png)

![image-20220531140712458](走进消息队列.assets/image-20220531140712458.png)

Proxy和Broker都是无状态的，读写分离

![image-20220531140654104](走进消息队列.assets/image-20220531140654104.png)

![image-20220531140828926](走进消息队列.assets/image-20220531140828926.png)

![image-20220531141112486](走进消息队列.assets/image-20220531141112486.png)

同一个partition的所有segment打散到整个集群上

![image-20220531141148931](走进消息队列.assets/image-20220531141148931.png)

![image-20220531154409669](走进消息队列.assets/image-20220531154409669.png)

![image-20220531154822390](走进消息队列.assets/image-20220531154822390.png)

![image-20220531154924583](走进消息队列.assets/image-20220531154924583.png)

![image-20220531155223652](走进消息队列.assets/image-20220531155223652.png)

![image-20220531160026442](走进消息队列.assets/image-20220531160026442.png)

![image-20220531160120119](走进消息队列.assets/image-20220531160120119.png)

![image-20220531160238135](走进消息队列.assets/image-20220531160238135.png)

![image-20220531160259843](走进消息队列.assets/image-20220531160259843.png)

![image-20220531160358026](走进消息队列.assets/image-20220531160358026.png)

![image-20220531160640923](走进消息队列.assets/image-20220531160640923.png)

![image-20220531160747493](走进消息队列.assets/image-20220531160747493.png)

![image-20220531161354145](走进消息队列.assets/image-20220531161354145.png)

![image-20220531161701365](走进消息队列.assets/image-20220531161701365.png)

![image-20220531161846409](走进消息队列.assets/image-20220531161846409.png)

![image-20220531162101690](走进消息队列.assets/image-20220531162101690.png)

![image-20220531162224213](走进消息队列.assets/image-20220531162224213.png)

![image-20220531162304192](走进消息队列.assets/image-20220531162304192.png)

![image-20220531162415125](走进消息队列.assets/image-20220531162415125.png)

![image-20220531163933419](走进消息队列.assets/image-20220531163933419.png)

![image-20220531163944731](走进消息队列.assets/image-20220531163944731.png)

RocketMQ

![image-20220531164046812](走进消息队列.assets/image-20220531164046812.png)

![image-20220531164204426](走进消息队列.assets/image-20220531164204426.png)

![image-20220531164538924](走进消息队列.assets/image-20220531164538924.png)

![image-20220531165127751](走进消息队列.assets/image-20220531165127751.png)

![image-20220531165239574](走进消息队列.assets/image-20220531165239574.png)

![image-20220531165512625](走进消息队列.assets/image-20220531165512625.png)

![image-20220531165741250](走进消息队列.assets/image-20220531165741250.png)

![image-20220531165949485](走进消息队列.assets/image-20220531165949485.png)

![image-20220531170042997](走进消息队列.assets/image-20220531170042997.png)

![image-20220531170122838](走进消息队列.assets/image-20220531170122838.png)

![image-20220531170427193](走进消息队列.assets/image-20220531170427193.png)

![image-20220531170443979](走进消息队列.assets/image-20220531170443979.png)

![image-20220531170525280](走进消息队列.assets/image-20220531170525280.png)

- 幂等性需要业务逻辑自己保证









